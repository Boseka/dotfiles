#!/usr/bin/zsh
# this file contains commands that will be executed when user is logged in
#
# Use a lockfile so that tmux does not execute these commands on creation of
# a new window.
LOCKFILE="/tmp/zprofile.lock"
if [[ ! -e $LOCKFILE ]]; then
    # create lock file
    touch $LOCKFILE

    # turn off discrete vga card
    sudo ~/git/scripts/vgaoff

    # change backlight level, load module, run wicd daemon..
    source .zshrc
    bklt 35
    sudo modprobe vboxdrv
    sudo wicd

    # load X
    echo -n "Loading X in 3 ... "
    read -t 1
    if [ $? -eq 1 ]; then
        echo -n "2 ... "
        read -t 1
        if [ $? -eq 1 ]; then
            echo -n "1 ... "
            read -t 1
            [ $? -eq 1 ] && startx
        fi
    fi

    # quit X? attach tmux
    tmux attach -t "$TMUX_DEFAULT_SESSION"
fi